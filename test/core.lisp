(in-package #:cbor-tests)

(define-test (core numbers)
  (cbor-test "00" t 0)
  (cbor-test "01" t 1)
  (cbor-test "0a" t 10)
  (cbor-test "17" t 23)
  (cbor-test "1818" t 24)
  (cbor-test "1819" t 25)
  (cbor-test "1864" t 100)
  (cbor-test "1903e8" t 1000)
  (cbor-test "1a000f4240" t 1000000)
  (cbor-test "1b000000e8d4a51000" t 1000000000000)
  (cbor-test "1bffffffffffffffff" t 18446744073709551615)
  (cbor-test "c249010000000000000000" t 18446744073709551616)
  (cbor-test "3bffffffffffffffff" t -18446744073709551616)
  (cbor-test "c349010000000000000000" t -18446744073709551617)
  (cbor-test "20" t -1)
  (cbor-test "29" t -10)
  (cbor-test "3863" t -100)
  (cbor-test "3903e7" t -1000)
  (cbor-test "f90000" t 0.0)
  (cbor-test "f98000" t -0.0)
  (cbor-test "f93c00" t 1.0)
  (cbor-test "fb3ff199999999999a" t 1.1d0)
  (cbor-test "f93e00" t 1.5)
  (cbor-test "f97bff" t 65504.0)
  (cbor-test "fa47c35000" t 100000.0)
  (cbor-test "fa7f7fffff" t 3.4028234663852886e+38)
  (cbor-test "fb7e37e43c8800759c" t 1.0d300)
  (cbor-test "f90001" t 5.960464477539063e-08)
  (cbor-test "f90400" t 6.103515625e-05)
  (cbor-test "f9c400" t -4.0)
  (cbor-test "fbc010666666666666" t -4.1d0))

(define-test (core values)
  (cbor-test "f4" nil nil) ;; false (no roundtrip - encoding it back produces null)
  (cbor-test "f5" t t)     ;; true
  (cbor-test "f6" t nil)   ;; null
  (cbor-test "f7" nil nil) ;; undefined (no roundtrip)
  (cbor-test "f0" t '(cbor::simple . 16))
  (cbor-test "f818" t '(cbor::simple . 24))
  (cbor-test "f8ff" t '(cbor::simple . 255))
  (cbor-test-date "c074323031332d30332d32315432303a30343a30305a"
                  "2013-03-21T22:04:00.000000+02:00")
  (cbor-test-date "c11a514b67b0" "2013-03-21T22:04:00.000000+02:00")
  (cbor-test-date "c1fb41d452d9ec200000" "2013-03-21T22:04:00.500000+02:00")
  (cbor-test "40" t #())
  (cbor-test "4401020304" t #(1 2 3 4))
  (cbor-test "60" t "")
  (cbor-test "6161" t "a")
  (cbor-test "6449455446" t "IETF")
  (cbor-test "62225c" t "\"\\")
  (cbor-test "62c3bc" t "√º")
  (cbor-test "63e6b0b4" t "Ê∞¥")
  (cbor-test "64f0908591" t "êÖë")
  (cbor-test "80" t #())
  (cbor-test "83010203" t #(1 2 3))
  (cbor-test "8301820203820405" t #$[ 1, [ 2,3 ], [ 4,5 ] ])
  (cbor-test "98190102030405060708090a0b0c0d0e0f101112131415161718181819" t
             #$[ 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25 ])
  (cbor-test "a0" t #${})
  (let ((hash (make-hash-table :test #'equal)))
    (setf (gethash 1 hash) 2
          (gethash 3 hash) 4)
    (cbor-test "a201020304" t hash))
  (cbor-test "a26161016162820203" t #${ "a": 1, "b": [ 2, 3 ] })
  (cbor-test "826161a161626163" t #$[ "a", { "b": "c" } ])
  (cbor-test "a56161614161626142616361436164614461656145" t
             #${ "a": "A", "b": "B", "c": "C", "d": "D", "e": "E" })
  (cbor-test "5f42010243030405ff" nil #(1 2 3 4 5))
  (cbor-test "7f657374726561646d696e67ff" nil "streaming")
  (cbor-test "9fff" nil #())
  (cbor-test "9f018202039f0405ffff" nil #$[ 1, [ 2, 3 ], [ 4, 5 ] ])
  (cbor-test "9f01820203820405ff" nil #$[ 1, [ 2, 3 ], [ 4, 5 ] ])
  (cbor-test "83018202039f0405ff" nil #$[ 1, [ 2, 3 ], [ 4, 5 ] ])
  (cbor-test "83019f0203ff820405" nil #$[ 1, [ 2, 3 ], [ 4, 5 ] ])
  (cbor-test "9f0102030405060708090a0b0c0d0e0f101112131415161718181819ff" nil
             #$[ 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25 ])
  (cbor-test "bf61610161629f0203ffff" nil #${ "a": 1, "b": [ 2, 3 ] })
  (cbor-test "826161bf61626163ff" nil #$[ "a", { "b": "c" } ])
  (cbor-test "bf6346756ef563416d7421ff" nil #${ "Fun": true, "Amt": -2 }))
